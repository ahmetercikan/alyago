<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlyaGo - Ä°ngilizce Ã–ÄŸrenme Platformu</title>

    <!-- App Icons ve Favicon -->
    <!-- Standart favicon (tarayÄ±cÄ± sekmesi) -->
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <link rel="shortcut icon" href="logo.svg">

    <!-- iOS Safari iÃ§in Ã¶zel icon (180x180 PNG gerekli) -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

    <!-- Android Chrome iÃ§in -->
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AlyaGo">
    <meta name="description" content="EÄŸlenceli Ä°ngilizce Ã–ÄŸrenme Platformu">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .pulse-success {
            animation: pulse-success 0.5s;
        }
        
        @keyframes pulse-success {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Animasyonlu karakter iÃ§in stil */
        .floating-character {
            position: fixed;
            z-index: 1000;
            transition: all 2s ease-in-out;
            pointer-events: none;
        }

        .character-body {
            position: relative;
            animation: bounce 3s infinite, sway 4s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(0deg); }
        }

        @keyframes sway {
            0%, 100% { transform: translateY(0px) rotate(-3deg); }
            25% { transform: translateY(-10px) rotate(3deg); }
            50% { transform: translateY(-20px) rotate(-3deg); }
            75% { transform: translateY(-10px) rotate(3deg); }
        }

        .character-face {
            border-radius: 50%;
            border: 5px solid #fff;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            animation: head-tilt 3s infinite;
        }

        @keyframes head-tilt {
            0%, 100% { transform: rotate(-2deg) scale(1); }
            50% { transform: rotate(2deg) scale(1.02); }
        }

        /* Karakter vÃ¼cudu SVG stilleri */
        .character-body-svg {
            filter: drop-shadow(0 4px 10px rgba(0,0,0,0.2));
        }

        .arm-left {
            animation: wave-left 2s infinite;
            transform-origin: 30% 20%;
        }

        .arm-right {
            animation: wave-right 2.5s infinite;
            transform-origin: 70% 20%;
        }

        @keyframes wave-left {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(-15deg); }
        }

        @keyframes wave-right {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(15deg); }
        }

        .leg-left, .leg-right {
            animation: walk 1.5s infinite;
        }

        .leg-right {
            animation-delay: 0.75s;
        }

        @keyframes walk {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(5px); }
        }

        /* Kamera Ã§erÃ§evesi */
        .camera-frame {
            position: relative;
            width: 250px;
            height: 320px;
            margin: 0 auto;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 4px dashed #667eea;
            border-radius: 50%;
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {
            0%, 100% { border-color: #667eea; transform: scale(1); }
            50% { border-color: #764ba2; transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Web Speech API - Sesli okuma fonksiyonu
        const speak = (text, lang = 'en-US') => {
            if ('speechSynthesis' in window) {
                // Mevcut konuÅŸmayÄ± durdur
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.9; // Biraz daha yavaÅŸ konuÅŸ
                utterance.pitch = 1;
                utterance.volume = 1;

                window.speechSynthesis.speak(utterance);
            } else {
                alert('TarayÄ±cÄ±nÄ±z sesli okuma Ã¶zelliÄŸini desteklemiyor.');
            }
        };

        // KonuÅŸma tanÄ±ma fonksiyonu
        const startSpeechRecognition = (expectedText, onResult) => {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('TarayÄ±cÄ±nÄ±z konuÅŸma tanÄ±ma Ã¶zelliÄŸini desteklemiyor. Chrome veya Edge kullanmayÄ± deneyin.');
                return null;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();

            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.maxAlternatives = 3; // Daha fazla alternatif dene

            // Daha uzun dinleme sÃ¼resi
            if (recognition.maxResults) {
                recognition.maxResults = 5;
            }

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase().trim();
                const expected = expectedText.toLowerCase().trim();

                // Basit benzerlik kontrolÃ¼
                const similarity = calculateSimilarity(transcript, expected);
                onResult(transcript, similarity);
            };

            recognition.onerror = (event) => {
                console.error('KonuÅŸma tanÄ±ma hatasÄ±:', event.error);

                let errorMessage = 'Mikrofon hatasÄ±. ';

                switch(event.error) {
                    case 'not-allowed':
                    case 'permission-denied':
                        errorMessage = 'Mikrofon izni verilmedi. LÃ¼tfen tarayÄ±cÄ± ayarlarÄ±ndan mikrofon iznini verin.';
                        break;
                    case 'no-speech':
                        errorMessage = 'Ses algÄ±lanamadÄ±. LÃ¼tfen daha yÃ¼ksek sesle konuÅŸun.';
                        break;
                    case 'network':
                        errorMessage = 'Ä°nternet baÄŸlantÄ± hatasÄ±. LÃ¼tfen internet baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                        break;
                    case 'audio-capture':
                        errorMessage = 'Mikrofon bulunamadÄ±. LÃ¼tfen mikrofonunuzun baÄŸlÄ± olduÄŸundan emin olun.';
                        break;
                    case 'aborted':
                        errorMessage = 'Ses tanÄ±ma iptal edildi.';
                        break;
                    default:
                        errorMessage = `Hata oluÅŸtu: ${event.error}`;
                }

                onResult(null, 0, errorMessage);
            };

            recognition.onstart = () => {
                console.log('Mikrofon dinlemeye baÅŸladÄ±');
            };

            recognition.onend = () => {
                console.log('Mikrofon dinleme sona erdi');
            };

            try {
                recognition.start();
            } catch (error) {
                console.error('Recognition baÅŸlatma hatasÄ±:', error);
                onResult(null, 0, 'Mikrofon baÅŸlatÄ±lamadÄ±. LÃ¼tfen sayfayÄ± yenileyin.');
            }

            return recognition;
        };

        // Metin benzerliÄŸi hesaplama (basit Levenshtein)
        const calculateSimilarity = (str1, str2) => {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;

            if (longer.length === 0) return 100;

            const editDistance = levenshteinDistance(longer, shorter);
            return ((longer.length - editDistance) / longer.length) * 100;
        };

        const levenshteinDistance = (str1, str2) => {
            const matrix = [];

            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }

            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }

            return matrix[str2.length][str1.length];
        };

        // KapsamlÄ± ders iÃ§eriÄŸi ve kelime veritabanÄ±
        const lessonsDatabase = {
            A1: {
                level: "BaÅŸlangÄ±Ã§ (A1)",
                units: [
                    {
                        id: 1,
                        name: "Kendini TanÄ±tma",
                        icon: "ğŸ‘‹",
                        lessons: [
                            {
                                id: 1,
                                title: "Merhaba Demek",
                                type: "vocabulary",
                                words: [
                                    { en: "Hello", tr: "Merhaba", image: "ğŸ‘‹", pronunciation: "heh-LOH" },
                                    { en: "Hi", tr: "Selam", image: "ğŸ˜Š", pronunciation: "hai" },
                                    { en: "Good morning", tr: "GÃ¼naydÄ±n", image: "ğŸŒ…", pronunciation: "gud MOR-ning" },
                                    { en: "Good evening", tr: "Ä°yi akÅŸamlar", image: "ğŸŒ†", pronunciation: "gud EEV-ning" },
                                    { en: "Goodbye", tr: "HoÅŸÃ§akal", image: "ğŸ‘‹", pronunciation: "gud-BAI" },
                                    { en: "See you", tr: "GÃ¶rÃ¼ÅŸÃ¼rÃ¼z", image: "ğŸ˜Š", pronunciation: "see yu" }
                                ]
                            },
                            {
                                id: 2,
                                title: "Kendini TanÄ±tma",
                                type: "phrases",
                                sentences: [
                                    { en: "My name is...", tr: "Benim adÄ±m...", example: "My name is Ahmet." },
                                    { en: "I am from Turkey", tr: "Ben TÃ¼rkiye'denim", example: "I am from Turkey." },
                                    { en: "I am ... years old", tr: "Ben ... yaÅŸÄ±ndayÄ±m", example: "I am 25 years old." },
                                    { en: "Nice to meet you", tr: "TanÄ±ÅŸtÄ±ÄŸÄ±mÄ±za memnun oldum", example: "Nice to meet you!" },
                                    { en: "How are you?", tr: "NasÄ±lsÄ±n?", example: "Hello! How are you?" },
                                    { en: "I am fine, thank you", tr: "Ä°yiyim, teÅŸekkÃ¼rler", example: "I am fine, thank you." }
                                ]
                            },
                            {
                                id: 3,
                                title: "SayÄ±lar 1-20",
                                type: "vocabulary",
                                words: [
                                    { en: "one", tr: "bir", image: "1ï¸âƒ£", pronunciation: "wuhn" },
                                    { en: "two", tr: "iki", image: "2ï¸âƒ£", pronunciation: "too" },
                                    { en: "three", tr: "Ã¼Ã§", image: "3ï¸âƒ£", pronunciation: "three" },
                                    { en: "four", tr: "dÃ¶rt", image: "4ï¸âƒ£", pronunciation: "for" },
                                    { en: "five", tr: "beÅŸ", image: "5ï¸âƒ£", pronunciation: "faiv" },
                                    { en: "ten", tr: "on", image: "ğŸ”Ÿ", pronunciation: "ten" },
                                    { en: "twenty", tr: "yirmi", image: "2ï¸âƒ£0ï¸âƒ£", pronunciation: "TWEN-tee" }
                                ]
                            }
                        ]
                    },
                    {
                        id: 2,
                        name: "GÃ¼nlÃ¼k Hayat",
                        icon: "ğŸ ",
                        lessons: [
                            {
                                id: 4,
                                title: "Aile Ãœyeleri",
                                type: "vocabulary",
                                words: [
                                    { en: "mother", tr: "anne", image: "ğŸ‘©", pronunciation: "MUH-ther" },
                                    { en: "father", tr: "baba", image: "ğŸ‘¨", pronunciation: "FAH-ther" },
                                    { en: "sister", tr: "kÄ±z kardeÅŸ", image: "ğŸ‘§", pronunciation: "SIS-ter" },
                                    { en: "brother", tr: "erkek kardeÅŸ", image: "ğŸ‘¦", pronunciation: "BRUH-ther" },
                                    { en: "family", tr: "aile", image: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", pronunciation: "FAM-i-lee" },
                                    { en: "grandmother", tr: "bÃ¼yÃ¼kanne", image: "ğŸ‘µ", pronunciation: "GRAND-muh-ther" }
                                ]
                            },
                            {
                                id: 5,
                                title: "Renkler",
                                type: "vocabulary",
                                words: [
                                    { en: "red", tr: "kÄ±rmÄ±zÄ±", image: "ğŸ”´", pronunciation: "red" },
                                    { en: "blue", tr: "mavi", image: "ğŸ”µ", pronunciation: "bloo" },
                                    { en: "green", tr: "yeÅŸil", image: "ğŸŸ¢", pronunciation: "green" },
                                    { en: "yellow", tr: "sarÄ±", image: "ğŸŸ¡", pronunciation: "YEL-oh" },
                                    { en: "black", tr: "siyah", image: "âš«", pronunciation: "blak" },
                                    { en: "white", tr: "beyaz", image: "âšª", pronunciation: "wite" }
                                ]
                            },
                            {
                                id: 6,
                                title: "Yiyecekler",
                                type: "vocabulary",
                                words: [
                                    { en: "apple", tr: "elma", image: "ğŸ", pronunciation: "AP-uhl" },
                                    { en: "bread", tr: "ekmek", image: "ğŸ", pronunciation: "bred" },
                                    { en: "water", tr: "su", image: "ğŸ’§", pronunciation: "WAW-ter" },
                                    { en: "milk", tr: "sÃ¼t", image: "ğŸ¥›", pronunciation: "milk" },
                                    { en: "egg", tr: "yumurta", image: "ğŸ¥š", pronunciation: "eg" },
                                    { en: "cheese", tr: "peynir", image: "ğŸ§€", pronunciation: "cheez" }
                                ]
                            }
                        ]
                    },
                    {
                        id: 3,
                        name: "Zaman ve Yer",
                        icon: "â°",
                        lessons: [
                            {
                                id: 7,
                                title: "HaftanÄ±n GÃ¼nleri",
                                type: "vocabulary",
                                words: [
                                    { en: "Monday", tr: "Pazartesi", image: "ğŸ“…", pronunciation: "MUN-day" },
                                    { en: "Tuesday", tr: "SalÄ±", image: "ğŸ“…", pronunciation: "TOOZ-day" },
                                    { en: "Wednesday", tr: "Ã‡arÅŸamba", image: "ğŸ“…", pronunciation: "WENZ-day" },
                                    { en: "Thursday", tr: "PerÅŸembe", image: "ğŸ“…", pronunciation: "THURZ-day" },
                                    { en: "Friday", tr: "Cuma", image: "ğŸ“…", pronunciation: "FRY-day" },
                                    { en: "Saturday", tr: "Cumartesi", image: "ğŸ“…", pronunciation: "SAT-er-day" },
                                    { en: "Sunday", tr: "Pazar", image: "ğŸ“…", pronunciation: "SUN-day" }
                                ]
                            },
                            {
                                id: 8,
                                title: "Yer Bildiren Ä°fadeler",
                                type: "phrases",
                                sentences: [
                                    { en: "Where is...?", tr: "... nerede?", example: "Where is the bathroom?" },
                                    { en: "Here", tr: "Burada", example: "I am here." },
                                    { en: "There", tr: "Orada", example: "The book is there." },
                                    { en: "In the house", tr: "Evde", example: "I am in the house." },
                                    { en: "At school", tr: "Okulda", example: "She is at school." },
                                    { en: "On the table", tr: "Masada", example: "The phone is on the table." }
                                ]
                            }
                        ]
                    }
                ]
            },
            A2: {
                level: "Temel (A2)",
                units: [
                    {
                        id: 4,
                        name: "AlÄ±ÅŸveriÅŸ ve Para",
                        icon: "ğŸ›’",
                        lessons: [
                            {
                                id: 9,
                                title: "AlÄ±ÅŸveriÅŸ CÃ¼mleleri",
                                type: "phrases",
                                sentences: [
                                    { en: "How much is this?", tr: "Bu ne kadar?", example: "How much is this shirt?" },
                                    { en: "I want to buy...", tr: "... almak istiyorum", example: "I want to buy a book." },
                                    { en: "Do you have...?", tr: "... var mÄ±?", example: "Do you have a red shirt?" },
                                    { en: "It's expensive", tr: "Bu pahalÄ±", example: "This watch is expensive." },
                                    { en: "It's cheap", tr: "Bu ucuz", example: "These shoes are cheap." }
                                ]
                            },
                            {
                                id: 10,
                                title: "MaÄŸaza Kelimeleri",
                                type: "vocabulary",
                                words: [
                                    { en: "shop", tr: "dÃ¼kkan", image: "ğŸª", pronunciation: "shop" },
                                    { en: "supermarket", tr: "sÃ¼permarket", image: "ğŸ¬", pronunciation: "SOO-per-mar-ket" },
                                    { en: "money", tr: "para", image: "ğŸ’°", pronunciation: "MUH-nee" },
                                    { en: "price", tr: "fiyat", image: "ğŸ’µ", pronunciation: "price" },
                                    { en: "expensive", tr: "pahalÄ±", image: "ğŸ’¸", pronunciation: "ik-SPEN-siv" },
                                    { en: "cheap", tr: "ucuz", image: "ğŸ·ï¸", pronunciation: "cheep" }
                                ]
                            }
                        ]
                    },
                    {
                        id: 5,
                        name: "Hobiler ve Aktiviteler",
                        icon: "âš½",
                        lessons: [
                            {
                                id: 11,
                                title: "Spor ve Hobiler",
                                type: "vocabulary",
                                words: [
                                    { en: "football", tr: "futbol", image: "âš½", pronunciation: "FUT-bawl" },
                                    { en: "music", tr: "mÃ¼zik", image: "ğŸµ", pronunciation: "MYOO-zik" },
                                    { en: "reading", tr: "okuma", image: "ğŸ“š", pronunciation: "REE-ding" },
                                    { en: "swimming", tr: "yÃ¼zme", image: "ğŸŠ", pronunciation: "SWIM-ing" },
                                    { en: "cooking", tr: "yemek piÅŸirme", image: "ğŸ³", pronunciation: "KUK-ing" },
                                    { en: "dancing", tr: "dans", image: "ğŸ’ƒ", pronunciation: "DAN-sing" }
                                ]
                            },
                            {
                                id: 12,
                                title: "Hobi CÃ¼mleleri",
                                type: "phrases",
                                sentences: [
                                    { en: "I like...", tr: "... seviyorum", example: "I like music." },
                                    { en: "I don't like...", tr: "... sevmiyorum", example: "I don't like football." },
                                    { en: "My hobby is...", tr: "Hobim...", example: "My hobby is reading." },
                                    { en: "I play...", tr: "... oynuyorum", example: "I play basketball." },
                                    { en: "I enjoy...", tr: "... yapmaktan hoÅŸlanÄ±yorum", example: "I enjoy swimming." }
                                ]
                            }
                        ]
                    }
                ]
            }
        };

        // Karakter TÃ¼rleri VeritabanÄ±
        const characterTypes = [
            {
                id: 'teddy',
                name: 'Oyuncak AyÄ±',
                emoji: 'ğŸ§¸',
                colors: { primary: '#FF6B9D', secondary: '#FF85B3', accent: '#FFB6D9' }
            },
            {
                id: 'robot',
                name: 'Robot',
                emoji: 'ğŸ¤–',
                colors: { primary: '#6B9DFF', secondary: '#85B3FF', accent: '#B6D9FF' }
            },
            {
                id: 'alien',
                name: 'UzaylÄ±',
                emoji: 'ğŸ‘½',
                colors: { primary: '#7FFF00', secondary: '#9AFF4D', accent: '#CCFF99' }
            },
            {
                id: 'superhero',
                name: 'SÃ¼per Kahraman',
                emoji: 'ğŸ¦¸',
                colors: { primary: '#FF4444', secondary: '#FF6666', accent: '#FFB3B3' }
            },
            {
                id: 'ninja',
                name: 'Ninja',
                emoji: 'ğŸ¥·',
                colors: { primary: '#2C2C2C', secondary: '#444444', accent: '#666666' }
            },
            {
                id: 'unicorn',
                name: 'Unicorn',
                emoji: 'ğŸ¦„',
                colors: { primary: '#FF00FF', secondary: '#FF4DFF', accent: '#FFB3FF' }
            },
            {
                id: 'dragon',
                name: 'Ejderha',
                emoji: 'ğŸ‰',
                colors: { primary: '#FF6600', secondary: '#FF8533', accent: '#FFB380' }
            },
            {
                id: 'mermaid',
                name: 'Deniz KÄ±zÄ±',
                emoji: 'ğŸ§œ',
                colors: { primary: '#00CED1', secondary: '#20E0E3', accent: '#80F0F3' }
            },
            {
                id: 'wizard',
                name: 'BÃ¼yÃ¼cÃ¼',
                emoji: 'ğŸ§™',
                colors: { primary: '#8B00FF', secondary: '#A333FF', accent: '#D199FF' }
            },
            {
                id: 'astronaut',
                name: 'Astronot',
                emoji: 'ğŸ§‘â€ğŸš€',
                colors: { primary: '#FFFFFF', secondary: '#E0E0E0', accent: '#C0C0C0' }
            },
            {
                id: 'pirate',
                name: 'Korsan',
                emoji: 'ğŸ´â€â˜ ï¸',
                colors: { primary: '#8B4513', secondary: '#A0522D', accent: '#D2691E' }
            },
            {
                id: 'fairy',
                name: 'Peri',
                emoji: 'ğŸ§š',
                colors: { primary: '#FFD700', secondary: '#FFE44D', accent: '#FFF099' }
            },
            {
                id: 'dinosaur',
                name: 'Dinozor',
                emoji: 'ğŸ¦•',
                colors: { primary: '#228B22', secondary: '#32CD32', accent: '#90EE90' }
            },
            {
                id: 'bee',
                name: 'ArÄ±',
                emoji: 'ğŸ',
                colors: { primary: '#FFD700', secondary: '#000000', accent: '#FFF8DC' }
            },
            {
                id: 'cat',
                name: 'Kedi',
                emoji: 'ğŸ±',
                colors: { primary: '#FFA500', secondary: '#FFB84D', accent: '#FFDDB3' }
            },
            {
                id: 'dog',
                name: 'KÃ¶pek',
                emoji: 'ğŸ¶',
                colors: { primary: '#8B4513', secondary: '#CD853F', accent: '#DEB887' }
            }
        ];

        // Ana Uygulama BileÅŸeni
        function AlyaGoApp() {
            const [userProfile, setUserProfile] = useState(null); // 'child' veya 'adult'
            const [currentScreen, setCurrentScreen] = useState('profile');
            const [currentLevel, setCurrentLevel] = useState('A1');
            const [currentUnit, setCurrentUnit] = useState(null);
            const [currentLesson, setCurrentLesson] = useState(null);
            const [characterPhoto, setCharacterPhoto] = useState(null); // Ã‡ocuk karakteri fotoÄŸrafÄ±
            const [selectedCharacter, setSelectedCharacter] = useState(characterTypes[0]); // SeÃ§ili karakter tipi
            const [characterPosition, setCharacterPosition] = useState({ x: 20, y: 20 }); // Karakter pozisyonu
            const [userProgress, setUserProgress] = useState({
                totalXP: 0,
                streak: 0,
                completedLessons: [],
                level: 'A1'
            });
            const [exerciseState, setExerciseState] = useState({
                currentQuestion: 0,
                score: 0,
                answers: [],
                showResult: false
            });
            const [listeningTest, setListeningTest] = useState({
                questions: [],
                currentQ: 0,
                score: 0,
                showResults: false
            });

            // Profil SeÃ§im EkranÄ±
            const ProfileSelectionScreen = () => (
                <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                    <div className="max-w-6xl w-full">
                        <div className="text-center text-white mb-12 fade-in">
                            <h1 className="text-7xl font-bold mb-4">AlyaGo</h1>
                            <p className="text-3xl font-light">Ä°ngilizce Ã–ÄŸrenme MacerasÄ±</p>
                        </div>

                        <div className="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                            {/* Ã‡ocuk Profili */}
                            <div
                                onClick={() => {
                                    setUserProfile('child');
                                    setCurrentScreen('character-create');
                                }}
                                className="bg-white rounded-3xl p-12 shadow-2xl card-hover cursor-pointer transform transition hover:scale-105"
                            >
                                <div className="text-center">
                                    <div className="text-8xl mb-6">ğŸ‘¶ğŸˆ</div>
                                    <h2 className="text-4xl font-bold text-purple-600 mb-4">Ã‡ocuk</h2>
                                    <p className="text-xl text-gray-600 mb-6">
                                        EÄŸlenceli oyunlar ve sesli anlatÄ±mlarla Ä°ngilizce Ã¶ÄŸren!
                                    </p>
                                    <ul className="text-left space-y-3 text-gray-700">
                                        <li className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ®</span>
                                            <span>Renkli ve eÄŸlenceli oyunlar</span>
                                        </li>
                                        <li className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ”Š</span>
                                            <span>Sesli TÃ¼rkÃ§e anlatÄ±m</span>
                                        </li>
                                        <li className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸŒŸ</span>
                                            <span>YÄ±ldÄ±z toplama sistemi</span>
                                        </li>
                                        <li className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ¨</span>
                                            <span>GÃ¶rsel odaklÄ± Ã¶ÄŸrenme</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            {/* YetiÅŸkin Profili */}
                            <div
                                onClick={() => {
                                    setUserProfile('adult');
                                    setCurrentScreen('home');
                                }}
                                className="bg-white rounded-3xl p-12 shadow-2xl card-hover cursor-pointer transform transition hover:scale-105"
                            >
                                <div className="text-center">
                                    <div className="text-8xl mb-6">ğŸ‘”ğŸ“š</div>
                                    <h2 className="text-4xl font-bold text-indigo-600 mb-4">YetiÅŸkin</h2>
                                    <p className="text-xl text-gray-600 mb-6">
                                        Sistematik ve detaylÄ± Ä°ngilizce eÄŸitimi
                                    </p>
                                    <ul className="text-left space-y-3 text-gray-700">
                                        <li className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ“–</span>
                                            <span>DetaylÄ± dilbilgisi dersleri</span>
                                        </li>
                                        <li className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ¤</span>
                                            <span>Telaffuz pratiÄŸi</span>
                                        </li>
                                        <li className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ“Š</span>
                                            <span>Ä°lerleme takibi</span>
                                        </li>
                                        <li className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ¯</span>
                                            <span>Seviye testleri</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // SVG Karakter VÃ¼cudu BileÅŸeni
            const CharacterBody = ({ character, size = 'normal', showAnimations = true }) => {
                const width = size === 'large' ? 200 : 140;
                const height = size === 'large' ? 280 : 200;
                const colors = character.colors;

                const scale = size === 'large' ? 1 : 0.7;

                return (
                    <svg width={width} height={height} viewBox={`0 0 ${width} ${height}`} className={showAnimations ? 'character-body-svg' : ''}>
                        {/* GÃ¶vde */}
                        <ellipse cx={width/2} cy={height*0.64} rx={60*scale} ry={70*scale} fill={colors.primary} />
                        <ellipse cx={width/2} cy={height*0.64} rx={50*scale} ry={60*scale} fill={colors.secondary} />

                        {/* Bacaklar */}
                        <g className={showAnimations ? 'leg-left' : ''}>
                            <ellipse cx={width/2 - 25*scale} cy={height*0.857} rx={18*scale} ry={35*scale} fill={colors.primary} />
                            <circle cx={width/2 - 25*scale} cy={height*0.964} r={15*scale} fill={colors.accent} />
                        </g>
                        <g className={showAnimations ? 'leg-right' : ''}>
                            <ellipse cx={width/2 + 25*scale} cy={height*0.857} rx={18*scale} ry={35*scale} fill={colors.primary} />
                            <circle cx={width/2 + 25*scale} cy={height*0.964} r={15*scale} fill={colors.accent} />
                        </g>

                        {/* Boyun */}
                        <rect x={width/2 - 15*scale} y={height*0.429} width={30*scale} height={25*scale} rx={15*scale} fill="#FFCC99" />

                        {/* Kollar */}
                        <g className={showAnimations ? 'arm-left' : ''}>
                            <ellipse cx={width/2 - 50*scale} cy={height*0.571} rx={15*scale} ry={45*scale} fill={colors.secondary} transform={`rotate(-20 ${width/2 - 50*scale} ${height*0.571})`} />
                            <circle cx={width/2 - 58*scale} cy={height*0.679} r={12*scale} fill={colors.accent} />
                        </g>
                        <g className={showAnimations ? 'arm-right' : ''}>
                            <ellipse cx={width/2 + 50*scale} cy={height*0.571} rx={15*scale} ry={45*scale} fill={colors.secondary} transform={`rotate(20 ${width/2 + 50*scale} ${height*0.571})`} />
                            <circle cx={width/2 + 58*scale} cy={height*0.679} r={12*scale} fill={colors.accent} />
                        </g>

                        {/* GÃ¶bek DetayÄ± */}
                        <circle cx={width/2} cy={height*0.661} r={8*scale} fill={colors.accent} opacity="0.5" />

                        {/* DÃ¼ÄŸmeler */}
                        <circle cx={width/2} cy={height*0.589} r={5*scale} fill="#FFF" />
                        <circle cx={width/2} cy={height*0.643} r={5*scale} fill="#FFF" />
                        <circle cx={width/2} cy={height*0.696} r={5*scale} fill="#FFF" />
                    </svg>
                );
            };

            // Karakter OluÅŸturma EkranÄ± (Sadece Ã‡ocuk Profili)
            const CharacterCreateScreen = () => {
                const [stream, setStream] = useState(null);
                const [capturedPhoto, setCapturedPhoto] = useState(null);
                const [videoReady, setVideoReady] = useState(false);
                const videoRef = React.useRef(null);
                const canvasRef = React.useRef(null);

                const startCamera = async () => {
                    try {
                        setVideoReady(false);
                        const mediaStream = await navigator.mediaDevices.getUserMedia({
                            video: {
                                facingMode: 'user',
                                width: { ideal: 640 },
                                height: { ideal: 640 }
                            }
                        });
                        setStream(mediaStream);

                        if (videoRef.current) {
                            videoRef.current.srcObject = mediaStream;

                            // Video yÃ¼klendiÄŸinde ready durumuna geÃ§
                            const handleCanPlay = async () => {
                                try {
                                    await videoRef.current.play();
                                    // Biraz bekle ve ready yap
                                    setTimeout(() => {
                                        setVideoReady(true);
                                    }, 800);
                                } catch (playError) {
                                    console.error('Video play hatasÄ±:', playError);
                                    // Yine de ready yap, bazÄ± tarayÄ±cÄ±larda autoplay Ã§alÄ±ÅŸÄ±r
                                    setTimeout(() => {
                                        setVideoReady(true);
                                    }, 1000);
                                }
                            };

                            // Birden fazla event dinle (tarayÄ±cÄ± uyumluluÄŸu iÃ§in)
                            videoRef.current.onloadedmetadata = handleCanPlay;
                            videoRef.current.oncanplay = handleCanPlay;

                            // GÃ¼venlik iÃ§in timeout: 3 saniye iÃ§inde ready olmazsa yine de aÃ§
                            setTimeout(() => {
                                if (!videoReady) {
                                    console.log('Timeout: Kamera zorla aÃ§Ä±lÄ±yor');
                                    setVideoReady(true);
                                }
                            }, 3000);
                        }
                    } catch (error) {
                        setVideoReady(false);
                        setStream(null);
                        alert('Kamera eriÅŸimi reddedildi veya bir hata oluÅŸtu. LÃ¼tfen tarayÄ±cÄ± ayarlarÄ±ndan kamera iznini verin ve sayfayÄ± yenileyin.');
                        console.error('Kamera hatasÄ±:', error);
                    }
                };

                const capturePhoto = () => {
                    if (!videoReady) {
                        alert('LÃ¼tfen kameranÄ±n hazÄ±r olmasÄ±nÄ± bekleyin...');
                        return;
                    }

                    if (videoRef.current && canvasRef.current) {
                        const canvas = canvasRef.current;
                        const video = videoRef.current;
                        const context = canvas.getContext('2d');

                        // Video'nun gerÃ§ekten gÃ¶rÃ¼ntÃ¼ iÃ§erip iÃ§ermediÄŸini kontrol et
                        if (video.readyState === video.HAVE_ENOUGH_DATA) {
                            canvas.width = 250;
                            canvas.height = 320;

                            // Videoyu canvas'a Ã§iz
                            context.drawImage(video, 0, 0, 250, 320);

                            // Data URL olarak al
                            const photoData = canvas.toDataURL('image/png');
                            setCapturedPhoto(photoData);

                            // KamerayÄ± kapat
                            if (stream) {
                                stream.getTracks().forEach(track => track.stop());
                            }
                            setVideoReady(false);
                        } else {
                            alert('Kamera henÃ¼z hazÄ±r deÄŸil. LÃ¼tfen birkaÃ§ saniye bekleyin.');
                        }
                    }
                };

                const retakePhoto = () => {
                    setCapturedPhoto(null);
                    startCamera();
                };

                const goToCharacterSelection = () => {
                    setCharacterPhoto(capturedPhoto);
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                    }
                    setCurrentScreen('character-select');
                };

                const skipCharacter = () => {
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                    }
                    setCurrentScreen('home');
                };

                React.useEffect(() => {
                    return () => {
                        if (stream) {
                            stream.getTracks().forEach(track => track.stop());
                        }
                    };
                }, [stream]);

                return (
                    <div className="min-h-screen bg-gradient-to-br from-yellow-200 via-pink-200 to-purple-300 flex items-center justify-center p-4">
                        <div className="max-w-2xl w-full bg-white rounded-3xl shadow-2xl p-8 fade-in">
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">ğŸ¨âœ¨</div>
                                <h2 className="text-4xl font-bold text-purple-600 mb-3">Karakterini OluÅŸtur!</h2>
                                <p className="text-xl text-gray-600">
                                    FotoÄŸrafÄ±nÄ± Ã§ek ve kendi Ã¶zel karakterinle Ã¶ÄŸren!
                                </p>
                            </div>

                            {!capturedPhoto ? (
                                <div className="space-y-6">
                                    {!stream ? (
                                        <div className="text-center space-y-6">
                                            <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-8">
                                                <div className="text-7xl mb-4">ğŸ“¸</div>
                                                <p className="text-lg text-gray-700 mb-6">
                                                    KameranÄ± kullanarak yÃ¼zÃ¼nÃ¼n fotoÄŸrafÄ±nÄ± Ã§ekeceÄŸiz.<br/>
                                                    Bu fotoÄŸraf senin Ã¶zel karakterin olacak!
                                                </p>
                                                <div className="bg-yellow-100 border-2 border-yellow-400 rounded-xl p-4 mb-4">
                                                    <p className="text-sm text-gray-700">
                                                        ğŸ’¡ <strong>Ä°pucu:</strong> YÃ¼zÃ¼nÃ¼ Ã§emberÄ±n iÃ§ine denk getir!
                                                    </p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={startCamera}
                                                className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 rounded-xl font-bold text-xl hover:from-purple-600 hover:to-pink-600 transition transform hover:scale-105"
                                            >
                                                ğŸ“¸ KamerayÄ± BaÅŸlat
                                            </button>
                                            <button
                                                onClick={skipCharacter}
                                                className="w-full bg-gray-300 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-400 transition"
                                            >
                                                Åimdilik GeÃ§
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="space-y-6">
                                            <div className="camera-frame relative mx-auto">
                                                <video
                                                    ref={videoRef}
                                                    autoPlay
                                                    playsInline
                                                    className="w-full h-full rounded-full object-cover"
                                                />
                                                <div className="camera-overlay"></div>
                                            </div>
                                            <div className="text-center">
                                                <p className="text-lg font-semibold text-purple-600 mb-4">
                                                    {videoReady ? 'YÃ¼zÃ¼nÃ¼ Ã§emberin iÃ§ine getir! ğŸ˜Š' : 'Kamera hazÄ±rlanÄ±yor... â³'}
                                                </p>
                                                {!videoReady && (
                                                    <div className="mb-4">
                                                        <div className="inline-block animate-spin rounded-full h-8 w-8 border-4 border-purple-500 border-t-transparent"></div>
                                                    </div>
                                                )}
                                            </div>
                                            <button
                                                onClick={capturePhoto}
                                                disabled={!videoReady}
                                                className={`w-full py-4 rounded-xl font-bold text-xl transition transform ${
                                                    videoReady
                                                        ? 'bg-gradient-to-r from-green-500 to-blue-500 text-white hover:from-green-600 hover:to-blue-600 hover:scale-105 cursor-pointer'
                                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                }`}
                                            >
                                                {videoReady ? 'âœ¨ FotoÄŸrafÄ± Ã‡ek!' : 'â³ LÃ¼tfen Bekleyin...'}
                                            </button>
                                            <button
                                                onClick={skipCharacter}
                                                className="w-full bg-gray-300 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-400 transition"
                                            >
                                                Ä°ptal
                                            </button>
                                        </div>
                                    )}
                                    <canvas ref={canvasRef} style={{ display: 'none' }} />
                                </div>
                            ) : (
                                <div className="space-y-6">
                                    <div className="text-center">
                                        <p className="text-2xl font-bold text-purple-600 mb-6">
                                            ğŸ‰ Harika! Ä°ÅŸte senin karakterin!
                                        </p>
                                        <div className="inline-block relative character-body">
                                            {/* Karakter Ã–nizlemesi */}
                                            <svg width="200" height="280" viewBox="0 0 200 280" className="character-body-svg">
                                                {/* GÃ¶vde */}
                                                <ellipse cx="100" cy="180" rx="60" ry="70" fill="#FF6B9D" />
                                                <ellipse cx="100" cy="180" rx="50" ry="60" fill="#FF85B3" />

                                                {/* Bacaklar */}
                                                <g className="leg-left">
                                                    <ellipse cx="75" cy="240" rx="18" ry="35" fill="#FF6B9D" />
                                                    <circle cx="75" cy="270" r="15" fill="#FFB6D9" />
                                                </g>
                                                <g className="leg-right">
                                                    <ellipse cx="125" cy="240" rx="18" ry="35" fill="#FF6B9D" />
                                                    <circle cx="125" cy="270" r="15" fill="#FFB6D9" />
                                                </g>

                                                {/* Boyun */}
                                                <rect x="85" y="120" width="30" height="25" rx="15" fill="#FFCC99" />

                                                {/* Kollar */}
                                                <g className="arm-left">
                                                    <ellipse cx="50" cy="160" rx="15" ry="45" fill="#FF85B3" transform="rotate(-20 50 160)" />
                                                    <circle cx="42" cy="190" r="12" fill="#FFB6D9" />
                                                </g>
                                                <g className="arm-right">
                                                    <ellipse cx="150" cy="160" rx="15" ry="45" fill="#FF85B3" transform="rotate(20 150 160)" />
                                                    <circle cx="158" cy="190" r="12" fill="#FFB6D9" />
                                                </g>

                                                {/* GÃ¶bek DetayÄ± */}
                                                <circle cx="100" cy="185" r="8" fill="#FFB6D9" opacity="0.5" />

                                                {/* DÃ¼ÄŸmeler */}
                                                <circle cx="100" cy="165" r="5" fill="#FFF" />
                                                <circle cx="100" cy="180" r="5" fill="#FFF" />
                                                <circle cx="100" cy="195" r="5" fill="#FFF" />
                                            </svg>

                                            {/* YÃ¼z - SVG'nin Ã¼zerine yerleÅŸtirilmiÅŸ */}
                                            <div style={{
                                                position: 'absolute',
                                                top: '5px',
                                                left: '50%',
                                                transform: 'translateX(-50%)',
                                                zIndex: 10
                                            }}>
                                                <img
                                                    src={capturedPhoto}
                                                    alt="Karakter"
                                                    className="character-face"
                                                    style={{
                                                        width: '100px',
                                                        height: '100px',
                                                        objectFit: 'cover',
                                                        display: 'block'
                                                    }}
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex gap-4">
                                        <button
                                            onClick={retakePhoto}
                                            className="flex-1 bg-yellow-500 text-white py-3 rounded-xl font-bold hover:bg-yellow-600 transition"
                                        >
                                            ğŸ”„ Tekrar Ã‡ek
                                        </button>
                                        <button
                                            onClick={goToCharacterSelection}
                                            className="flex-1 bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-xl font-bold hover:from-green-600 hover:to-blue-600 transition"
                                        >
                                            âœ… Devam â†’
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Karakter SeÃ§im EkranÄ±
            const CharacterSelectScreen = () => {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-200 via-purple-200 to-pink-200 p-4">
                        <div className="max-w-7xl mx-auto py-8">
                            <div className="text-center mb-8 fade-in">
                                <h1 className="text-5xl font-bold text-purple-700 mb-3">ğŸ­ Karakterini SeÃ§!</h1>
                                <p className="text-xl text-gray-700">Hangi karakter olmak istersin?</p>
                            </div>

                            {/* Karakter Grid */}
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4 mb-8">
                                {characterTypes.map((char) => (
                                    <div
                                        key={char.id}
                                        onClick={() => setSelectedCharacter(char)}
                                        className={`bg-white rounded-2xl p-6 cursor-pointer transform transition hover:scale-105 ${
                                            selectedCharacter.id === char.id
                                                ? 'ring-4 ring-purple-500 shadow-2xl scale-105'
                                                : 'shadow-lg hover:shadow-xl'
                                        }`}
                                    >
                                        <div className="text-center">
                                            <div className="text-6xl mb-3">{char.emoji}</div>
                                            <h3 className="font-bold text-lg mb-2">{char.name}</h3>

                                            {/* Mini Ã–nizleme */}
                                            <div className="relative inline-block" style={{ width: '80px', height: '120px' }}>
                                                <CharacterBody character={char} size="normal" showAnimations={false} />
                                                {characterPhoto && (
                                                    <div style={{
                                                        position: 'absolute',
                                                        top: '2px',
                                                        left: '50%',
                                                        transform: 'translateX(-50%)',
                                                        zIndex: 10
                                                    }}>
                                                        <img
                                                            src={characterPhoto}
                                                            alt="Preview"
                                                            style={{
                                                                width: '42px',
                                                                height: '42px',
                                                                borderRadius: '50%',
                                                                border: '3px solid #fff',
                                                                objectFit: 'cover',
                                                                boxShadow: '0 2px 8px rgba(0,0,0,0.3)'
                                                            }}
                                                        />
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* SeÃ§ili Karakter BÃ¼yÃ¼k Ã–nizleme */}
                            <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-2xl mx-auto fade-in">
                                <div className="text-center">
                                    <h2 className="text-3xl font-bold text-purple-600 mb-6">
                                        âœ¨ SeÃ§tiÄŸin Karakter: {selectedCharacter.name} {selectedCharacter.emoji}
                                    </h2>

                                    <div className="inline-block relative character-body mb-6">
                                        <CharacterBody character={selectedCharacter} size="large" showAnimations={true} />
                                        {characterPhoto && (
                                            <div style={{
                                                position: 'absolute',
                                                top: '5px',
                                                left: '50%',
                                                transform: 'translateX(-50%)',
                                                zIndex: 10
                                            }}>
                                                <img
                                                    src={characterPhoto}
                                                    alt="Karakter"
                                                    className="character-face"
                                                    style={{
                                                        width: '100px',
                                                        height: '100px',
                                                        objectFit: 'cover',
                                                        display: 'block'
                                                    }}
                                                />
                                            </div>
                                        )}
                                    </div>

                                    <p className="text-lg text-gray-600 mb-6">
                                        Harika gÃ¶rÃ¼nÃ¼yor! Bu karakterinle maceraya hazÄ±r mÄ±sÄ±n?
                                    </p>

                                    <div className="flex gap-4">
                                        <button
                                            onClick={() => setCurrentScreen('character-create')}
                                            className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-400 transition"
                                        >
                                            â† Geri
                                        </button>
                                        <button
                                            onClick={() => setCurrentScreen('home')}
                                            className="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl font-bold hover:from-purple-600 hover:to-pink-600 transition transform hover:scale-105"
                                        >
                                            ğŸš€ Oyuna BaÅŸla!
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Ana Ekran
            const HomeScreen = () => {
                const isChild = userProfile === 'child';

                return (
                <div className="min-h-screen gradient-bg">
                    <div className="container mx-auto px-4 py-8">
                        {/* Header */}
                        <div className="text-center text-white mb-12 fade-in">
                            <div className="flex justify-between items-center mb-4">
                                <button
                                    onClick={() => {
                                        setUserProfile(null);
                                        setCharacterPhoto(null);
                                        setCurrentScreen('profile');
                                    }}
                                    className="px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition"
                                >
                                    â† Profil DeÄŸiÅŸtir
                                </button>
                                <div className="flex items-center gap-3">
                                    {isChild && (
                                        <>
                                            <button
                                                onClick={() => setCurrentScreen('character-select')}
                                                className="px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition text-sm"
                                                title="Karakter DeÄŸiÅŸtir"
                                            >
                                                ğŸ­ Karakter DeÄŸiÅŸtir
                                            </button>
                                            <button
                                                onClick={() => setCurrentScreen('character-create')}
                                                className="px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition text-sm"
                                                title="FotoÄŸraf DeÄŸiÅŸtir"
                                            >
                                                ğŸ“¸ FotoÄŸraf DeÄŸiÅŸtir
                                            </button>
                                        </>
                                    )}
                                    <div className="text-2xl">{isChild ? 'ğŸ‘¶' : 'ğŸ‘”'}</div>
                                </div>
                            </div>
                            <h1 className="text-6xl font-bold mb-4">
                                {isChild ? 'ğŸˆ AlyaGo ğŸ®' : 'AlyaGo'}
                            </h1>
                            <p className="text-2xl font-light">
                                {isChild ? 'Ä°ngilizce Ã–ÄŸrenme Oyunu!' : 'Daha Ä°yi Ä°ngilizce Ã–ÄŸrenin'}
                            </p>
                            <div className="mt-6 flex justify-center space-x-8">
                                <div className="bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm">
                                    <div className="text-3xl font-bold">{userProgress.totalXP}</div>
                                    <div className="text-sm">XP PuanÄ±</div>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm">
                                    <div className="text-3xl font-bold">{userProgress.streak} ğŸ”¥</div>
                                    <div className="text-sm">GÃ¼n Serisi</div>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm">
                                    <div className="text-3xl font-bold">{userProgress.completedLessons.length}</div>
                                    <div className="text-sm">Ders TamamlandÄ±</div>
                                </div>
                            </div>
                        </div>

                        {/* Sesli Test Butonu */}
                        <div className="bg-white rounded-3xl shadow-2xl p-6 max-w-6xl mx-auto mb-6">
                            <button
                                onClick={() => setCurrentScreen('listening')}
                                className="w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-2xl p-8 card-hover cursor-pointer text-center"
                            >
                                <div className="text-6xl mb-4">ğŸ‘‚ğŸ§</div>
                                <h3 className="text-3xl font-bold mb-2">Dinleme Testi</h3>
                                <p className="text-lg opacity-90">Sesli kelimeleri dinle, doÄŸru cevabÄ± bul!</p>
                            </button>
                        </div>

                        {/* Seviye SeÃ§imi */}
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-6xl mx-auto">
                            <h2 className="text-3xl font-bold text-gray-800 mb-8 text-center">Seviyeni SeÃ§</h2>
                            <div className="grid md:grid-cols-2 gap-6">
                                {Object.keys(lessonsDatabase).map(level => (
                                    <div
                                        key={level}
                                        onClick={() => {
                                            setCurrentLevel(level);
                                            setCurrentScreen('units');
                                        }}
                                        className="card-hover bg-gradient-to-br from-purple-400 to-indigo-500 rounded-2xl p-8 cursor-pointer text-white"
                                    >
                                        <div className="text-5xl mb-4">
                                            {level === 'A1' ? 'ğŸŒ±' : 'ğŸŒ¿'}
                                        </div>
                                        <h3 className="text-2xl font-bold mb-2">{level}</h3>
                                        <p className="text-lg opacity-90">{lessonsDatabase[level].level}</p>
                                        <div className="mt-4 bg-white bg-opacity-20 rounded-full h-2">
                                            <div
                                                className="bg-white h-full rounded-full progress-bar"
                                                style={{width: `${(userProgress.completedLessons.filter(l => l.startsWith(level)).length /
                                                    lessonsDatabase[level].units.reduce((sum, u) => sum + u.lessons.length, 0)) * 100}%`}}
                                            />
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* Ã–zellikler */}
                            <div className="mt-12 grid md:grid-cols-4 gap-6">
                                <div className="text-center p-6 bg-blue-50 rounded-xl">
                                    <div className="text-4xl mb-3">ğŸ”Š</div>
                                    <h4 className="font-bold text-lg mb-2">Sesli Telaffuz</h4>
                                    <p className="text-gray-600">Her kelimeyi gerÃ§ek Ä°ngilizce aksanla dinle</p>
                                </div>
                                <div className="text-center p-6 bg-green-50 rounded-xl">
                                    <div className="text-4xl mb-3">ğŸ¤</div>
                                    <h4 className="font-bold text-lg mb-2">KonuÅŸma PratiÄŸi</h4>
                                    <p className="text-gray-600">Telaffuzunu test et, geri bildirim al</p>
                                </div>
                                <div className="text-center p-6 bg-purple-50 rounded-xl">
                                    <div className="text-4xl mb-3">ğŸ‘‚</div>
                                    <h4 className="font-bold text-lg mb-2">Dinleme Testleri</h4>
                                    <p className="text-gray-600">DuyduÄŸun kelimeleri tanÄ±, puan kazan</p>
                                </div>
                                <div className="text-center p-6 bg-yellow-50 rounded-xl">
                                    <div className="text-4xl mb-3">ğŸ†</div>
                                    <h4 className="font-bold text-lg mb-2">XP Sistemi</h4>
                                    <p className="text-gray-600">Pratik yap, puan kazan, seviye atla</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                );
            };

            // Ãœnite Listesi EkranÄ±
            const UnitsScreen = () => {
                const levelData = lessonsDatabase[currentLevel];
                
                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="gradient-bg text-white p-6">
                            <button 
                                onClick={() => setCurrentScreen('home')}
                                className="mb-4 px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition"
                            >
                                â† Geri
                            </button>
                            <h1 className="text-4xl font-bold">{levelData.level}</h1>
                        </div>

                        <div className="container mx-auto px-4 py-8">
                            <div className="max-w-4xl mx-auto space-y-6">
                                {levelData.units.map(unit => (
                                    <div key={unit.id} className="bg-white rounded-2xl shadow-lg p-6 fade-in">
                                        <div className="flex items-center justify-between mb-4">
                                            <div className="flex items-center">
                                                <div className="text-5xl mr-4">{unit.icon}</div>
                                                <div>
                                                    <h3 className="text-2xl font-bold text-gray-800">{unit.name}</h3>
                                                    <p className="text-gray-600">{unit.lessons.length} ders</p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-sm text-gray-500">Ä°lerleme</div>
                                                <div className="font-bold text-lg text-purple-600">
                                                    {unit.lessons.filter(l => 
                                                        userProgress.completedLessons.includes(`${currentLevel}-${unit.id}-${l.id}`)
                                                    ).length} / {unit.lessons.length}
                                                </div>
                                            </div>
                                        </div>

                                        <div className="space-y-3">
                                            {unit.lessons.map(lesson => {
                                                const isCompleted = userProgress.completedLessons.includes(
                                                    `${currentLevel}-${unit.id}-${lesson.id}`
                                                );
                                                
                                                return (
                                                    <div
                                                        key={lesson.id}
                                                        onClick={() => {
                                                            setCurrentUnit(unit);
                                                            setCurrentLesson(lesson);
                                                            setCurrentScreen('lesson');
                                                        }}
                                                        className="flex items-center justify-between p-4 bg-gray-50 rounded-xl hover:bg-purple-50 cursor-pointer transition card-hover"
                                                    >
                                                        <div className="flex items-center">
                                                            <div className={`w-10 h-10 rounded-full flex items-center justify-center mr-4 ${
                                                                isCompleted ? 'bg-green-500' : 'bg-purple-500'
                                                            } text-white font-bold`}>
                                                                {isCompleted ? 'âœ“' : lesson.id}
                                                            </div>
                                                            <div>
                                                                <div className="font-semibold text-gray-800">{lesson.title}</div>
                                                                <div className="text-sm text-gray-500">
                                                                    {lesson.type === 'vocabulary' ? 'ğŸ“š Kelime' : 
                                                                     lesson.type === 'phrases' ? 'ğŸ’¬ CÃ¼mleler' : 'âœï¸ AlÄ±ÅŸtÄ±rma'}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="text-purple-600 font-bold">â†’</div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // Ders EkranÄ±
            const LessonScreen = () => {
                const [currentStep, setCurrentStep] = useState(0);
                const [showAnswer, setShowAnswer] = useState(false);
                const [userAnswer, setUserAnswer] = useState('');
                const [feedback, setFeedback] = useState(null);
                const [isRecording, setIsRecording] = useState(false);
                const [speechResult, setSpeechResult] = useState(null);

                const content = currentLesson.type === 'vocabulary' ? currentLesson.words : currentLesson.sentences;
                const totalSteps = content.length;

                const handleNext = () => {
                    if (currentStep < totalSteps - 1) {
                        setCurrentStep(currentStep + 1);
                        setShowAnswer(false);
                        setUserAnswer('');
                        setFeedback(null);
                        setSpeechResult(null);
                    } else {
                        // Dersi bitir
                        const lessonId = `${currentLevel}-${currentUnit.id}-${currentLesson.id}`;
                        if (!userProgress.completedLessons.includes(lessonId)) {
                            setUserProgress({
                                ...userProgress,
                                completedLessons: [...userProgress.completedLessons, lessonId],
                                totalXP: userProgress.totalXP + 50
                            });
                        }
                        setCurrentScreen('exercise');
                        initExercise();
                    }
                };

                const handleSpeechPractice = () => {
                    if (isRecording) return;

                    setIsRecording(true);
                    setSpeechResult(null);

                    const expectedText = currentItem.en || currentItem.example;

                    startSpeechRecognition(expectedText, (transcript, similarity, errorMsg) => {
                        setIsRecording(false);

                        if (errorMsg) {
                            setSpeechResult({
                                success: false,
                                message: errorMsg,
                                transcript: null
                            });
                            return;
                        }

                        if (!transcript) {
                            setSpeechResult({
                                success: false,
                                message: 'Ses algÄ±lanamadÄ±. LÃ¼tfen daha net konuÅŸun.',
                                transcript: null
                            });
                            return;
                        }

                        const success = similarity >= 70;

                        if (success) {
                            setUserProgress({
                                ...userProgress,
                                totalXP: userProgress.totalXP + 5
                            });
                        }

                        setSpeechResult({
                            success,
                            similarity: Math.round(similarity),
                            transcript,
                            message: success
                                ? `Harika! %${Math.round(similarity)} benzerlik! +5 XP`
                                : `Tekrar dene. DoÄŸru telaffuz: "${expectedText}"`
                        });
                    });
                };

                const initExercise = () => {
                    setExerciseState({
                        currentQuestion: 0,
                        score: 0,
                        answers: [],
                        showResult: false
                    });
                };

                const currentItem = content[currentStep];

                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="gradient-bg text-white p-6">
                            <button 
                                onClick={() => setCurrentScreen('units')}
                                className="mb-4 px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition"
                            >
                                â† Geri
                            </button>
                            <h1 className="text-3xl font-bold">{currentLesson.title}</h1>
                            <div className="mt-4 bg-white bg-opacity-20 rounded-full h-3">
                                <div 
                                    className="bg-white h-full rounded-full progress-bar"
                                    style={{width: `${((currentStep + 1) / totalSteps) * 100}%`}}
                                />
                            </div>
                            <p className="mt-2 text-sm">{currentStep + 1} / {totalSteps}</p>
                        </div>

                        <div className="container mx-auto px-4 py-12">
                            <div className="max-w-2xl mx-auto">
                                <div className="bg-white rounded-3xl shadow-2xl p-12 text-center fade-in">
                                    {currentLesson.type === 'vocabulary' ? (
                                        <>
                                            <div className="text-9xl mb-8">{currentItem.image}</div>
                                            <div className="flex items-center justify-center gap-4 mb-4">
                                                <div className="text-5xl font-bold text-gray-800">{currentItem.en}</div>
                                                <button
                                                    onClick={() => speak(currentItem.en)}
                                                    className="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full transition transform hover:scale-110"
                                                    title="Telaffuzu dinle"
                                                >
                                                    <span className="text-2xl">ğŸ”Š</span>
                                                </button>
                                            </div>
                                            {showAnswer && (
                                                <div className="pulse-success">
                                                    <div className="text-3xl text-purple-600 mb-2">{currentItem.tr}</div>
                                                    <div className="text-xl text-gray-500 italic">/{currentItem.pronunciation}/</div>
                                                </div>
                                            )}
                                        </>
                                    ) : (
                                        <>
                                            <div className="flex items-center justify-center gap-4 mb-6">
                                                <div className="text-4xl font-bold text-gray-800">{currentItem.en}</div>
                                                <button
                                                    onClick={() => speak(currentItem.en)}
                                                    className="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-full transition transform hover:scale-110"
                                                    title="Telaffuzu dinle"
                                                >
                                                    <span className="text-xl">ğŸ”Š</span>
                                                </button>
                                            </div>
                                            {showAnswer && (
                                                <div className="pulse-success">
                                                    <div className="text-2xl text-purple-600 mb-4">{currentItem.tr}</div>
                                                    <div className="bg-gray-100 rounded-xl p-4 text-left">
                                                        <div className="text-sm text-gray-500 mb-2">Ã–rnek:</div>
                                                        <div className="text-xl text-gray-700">{currentItem.example}</div>
                                                    </div>
                                                </div>
                                            )}
                                        </>
                                    )}

                                    <div className="mt-8 space-y-4">
                                        {/* KonuÅŸma PratiÄŸi - Sadece YetiÅŸkinler */}
                                        {userProfile === 'adult' && (
                                        <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border-2 border-blue-200">
                                            <div className="text-center mb-4">
                                                <div className="text-lg font-bold text-gray-800 mb-2">ğŸ¤ KonuÅŸma PratiÄŸi</div>
                                                <p className="text-sm text-gray-600 mb-2">
                                                    {isRecording ? 'ğŸ”´ Åimdi konuÅŸun!' : 'Ã–nce kelimeyi dinleyin, sonra kendiniz sÃ¶yleyin'}
                                                </p>
                                                <div className="flex items-center justify-center gap-3 mb-3">
                                                    <div className="bg-white rounded-lg p-3 shadow">
                                                        <span className="text-2xl font-bold text-blue-600">{currentItem.en}</span>
                                                    </div>
                                                    <button
                                                        onClick={() => speak(currentItem.en)}
                                                        className="bg-green-500 hover:bg-green-600 text-white p-3 rounded-full transition transform hover:scale-110 shadow-lg"
                                                        title="Ã–nce telaffuzu dinle"
                                                    >
                                                        <span className="text-xl">ğŸ”Š</span>
                                                    </button>
                                                </div>
                                            </div>
                                            <button
                                                onClick={handleSpeechPractice}
                                                disabled={isRecording}
                                                className={`w-full py-5 rounded-xl font-bold text-xl transition transform shadow-lg ${
                                                    isRecording
                                                        ? 'bg-red-500 text-white animate-pulse scale-105'
                                                        : 'bg-blue-500 hover:bg-blue-600 text-white hover:scale-105'
                                                }`}
                                            >
                                                {isRecording ? 'ğŸ”´ Dinleniyor... KonuÅŸun!' : 'ğŸ¤ BaÅŸlat & KonuÅŸ'}
                                            </button>

                                            {isRecording && (
                                                <div className="mt-4 text-center">
                                                    <div className="flex justify-center space-x-2">
                                                        <div className="w-2 h-8 bg-red-500 rounded animate-pulse" style={{animationDelay: '0s'}}></div>
                                                        <div className="w-2 h-10 bg-red-500 rounded animate-pulse" style={{animationDelay: '0.1s'}}></div>
                                                        <div className="w-2 h-12 bg-red-500 rounded animate-pulse" style={{animationDelay: '0.2s'}}></div>
                                                        <div className="w-2 h-10 bg-red-500 rounded animate-pulse" style={{animationDelay: '0.3s'}}></div>
                                                        <div className="w-2 h-8 bg-red-500 rounded animate-pulse" style={{animationDelay: '0.4s'}}></div>
                                                    </div>
                                                    <p className="text-sm text-red-600 font-semibold mt-2">Mikrofonunuz aÃ§Ä±k, konuÅŸun!</p>
                                                </div>
                                            )}

                                            {speechResult && (
                                                <div className={`mt-4 p-4 rounded-lg ${
                                                    speechResult.success ? 'bg-green-100 border-2 border-green-500' : 'bg-yellow-100 border-2 border-yellow-500'
                                                }`}>
                                                    <div className={`font-bold mb-2 ${
                                                        speechResult.success ? 'text-green-800' : 'text-yellow-800'
                                                    }`}>
                                                        {speechResult.message}
                                                    </div>
                                                    {speechResult.transcript && (
                                                        <div className="text-sm text-gray-700">
                                                            DuyduÄŸum: "<span className="font-semibold">{speechResult.transcript}</span>"
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            {!speechResult && !isRecording && (
                                                <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
                                                    <div className="text-xs font-semibold text-blue-800 mb-1">ğŸ’¡ Ä°puÃ§larÄ±:</div>
                                                    <ul className="text-xs text-blue-700 space-y-1">
                                                        <li>â€¢ Butona tÄ±kladÄ±ktan sonra hemen konuÅŸmaya baÅŸlayÄ±n</li>
                                                        <li>â€¢ Net ve yÃ¼ksek sesle telaffuz edin</li>
                                                        <li>â€¢ Mikrofona yakÄ±n olun (20-30cm)</li>
                                                        <li>â€¢ Sessiz bir ortamda deneyin</li>
                                                    </ul>
                                                </div>
                                            )}
                                        </div>
                                        )}

                                        {/* CevabÄ± GÃ¶ster / Devam Et ButonlarÄ± */}
                                        {!showAnswer ? (
                                            <button
                                                onClick={() => setShowAnswer(true)}
                                                className="w-full py-4 bg-purple-600 text-white rounded-xl font-bold text-xl hover:bg-purple-700 transition"
                                            >
                                                CevabÄ± GÃ¶ster
                                            </button>
                                        ) : (
                                            <button
                                                onClick={handleNext}
                                                className="w-full py-4 bg-green-500 text-white rounded-xl font-bold text-xl hover:bg-green-600 transition"
                                            >
                                                {currentStep < totalSteps - 1 ? 'Devam Et' : 'AlÄ±ÅŸtÄ±rmaya GeÃ§'}
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // AlÄ±ÅŸtÄ±rma EkranÄ±
            const ExerciseScreen = () => {
                const [questions, setQuestions] = useState([]);
                const [currentQ, setCurrentQ] = useState(0);
                const [selectedAnswer, setSelectedAnswer] = useState(null);
                const [isCorrect, setIsCorrect] = useState(null);
                const [score, setScore] = useState(0);
                const [showResults, setShowResults] = useState(false);
                const isChild = userProfile === 'child';

                useEffect(() => {
                    generateQuestions();
                }, []);

                const generateQuestions = () => {
                    const content = currentLesson.type === 'vocabulary' ? currentLesson.words : currentLesson.sentences;
                    const generatedQuestions = [];

                    // Her kelime/cÃ¼mle iÃ§in bir soru oluÅŸtur
                    content.forEach(item => {
                        // Tip 1: Ä°ngilizce ver, TÃ¼rkÃ§e sor
                        const q1 = {
                            question: currentLesson.type === 'vocabulary' ? 
                                `"${item.en}" kelimesinin TÃ¼rkÃ§esi nedir?` :
                                `"${item.en}" cÃ¼mlesinin TÃ¼rkÃ§esi nedir?`,
                            correct: item.tr,
                            options: generateOptions(item.tr, content, 'tr')
                        };
                        generatedQuestions.push(q1);

                        // Tip 2: TÃ¼rkÃ§e ver, Ä°ngilizce sor
                        const q2 = {
                            question: currentLesson.type === 'vocabulary' ?
                                `"${item.tr}" kelimesinin Ä°ngilizcesi nedir?` :
                                `"${item.tr}" cÃ¼mlesinin Ä°ngilizcesi nedir?`,
                            correct: item.en,
                            options: generateOptions(item.en, content, 'en')
                        };
                        generatedQuestions.push(q2);
                    });

                    // SorularÄ± karÄ±ÅŸtÄ±r
                    setQuestions(shuffleArray(generatedQuestions).slice(0, 10));
                };

                const generateOptions = (correct, allItems, lang) => {
                    const options = [correct];
                    const otherOptions = allItems
                        .map(item => item[lang])
                        .filter(item => item !== correct);
                    
                    while (options.length < 4 && otherOptions.length > 0) {
                        const randomIndex = Math.floor(Math.random() * otherOptions.length);
                        options.push(otherOptions[randomIndex]);
                        otherOptions.splice(randomIndex, 1);
                    }
                    
                    return shuffleArray(options);
                };

                const shuffleArray = (array) => {
                    const newArray = [...array];
                    for (let i = newArray.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                    }
                    return newArray;
                };

                const handleAnswer = (answer) => {
                    if (selectedAnswer !== null) return;

                    setSelectedAnswer(answer);
                    const correct = answer === questions[currentQ].correct;
                    setIsCorrect(correct);

                    if (correct) {
                        setScore(score + 10);
                        setUserProgress({
                            ...userProgress,
                            totalXP: userProgress.totalXP + 10
                        });
                    }

                    setTimeout(() => {
                        if (currentQ < questions.length - 1) {
                            setCurrentQ(currentQ + 1);
                            setSelectedAnswer(null);
                            setIsCorrect(null);
                        } else {
                            setShowResults(true);
                        }
                    }, 1500);
                };

                // Ã‡ocuk modu iÃ§in soruyu sesli oku
                const speakQuestion = (questionText) => {
                    if (isChild) {
                        speak(questionText, 'tr-TR'); // TÃ¼rkÃ§e ses
                    }
                };

                // Soru deÄŸiÅŸtiÄŸinde sesli oku
                useEffect(() => {
                    if (isChild && questions.length > 0 && !showResults) {
                        setTimeout(() => {
                            speakQuestion(questions[currentQ].question);
                        }, 500);
                    }
                }, [currentQ, questions]);

                if (questions.length === 0) {
                    return <div className="min-h-screen flex items-center justify-center">
                        <div className="text-2xl">Sorular hazÄ±rlanÄ±yor...</div>
                    </div>;
                }

                if (showResults) {
                    const percentage = (score / (questions.length * 10)) * 100;

                    return (
                        <div className={`min-h-screen flex items-center justify-center p-4 ${isChild ? 'bg-gradient-to-br from-yellow-300 via-pink-300 to-purple-400' : 'gradient-bg'}`}>
                            <div className="bg-white rounded-3xl shadow-2xl p-12 max-w-2xl w-full text-center fade-in">
                                <div className="text-7xl mb-6">
                                    {isChild
                                        ? (percentage >= 80 ? 'ğŸ‰ğŸŒŸâ­' : percentage >= 60 ? 'ğŸ‘ğŸˆ' : 'ğŸ’ªğŸ®')
                                        : (percentage >= 80 ? 'ğŸ‰' : percentage >= 60 ? 'ğŸ‘' : 'ğŸ’ª')
                                    }
                                </div>
                                <h2 className={`text-4xl font-bold mb-4 ${isChild ? 'text-purple-600' : 'text-gray-800'}`}>
                                    {isChild ? 'HarikasÄ±n!' : 'Tebrikler!'}
                                </h2>
                                <div className={`text-6xl font-bold mb-6 ${isChild ? 'text-pink-500' : 'text-purple-600'}`}>
                                    {score} / {questions.length * 10} {isChild && 'â­'}
                                </div>
                                <div className="text-2xl text-gray-600 mb-8">
                                    {isChild
                                        ? (percentage >= 80 ? 'SÃ¼persin! ğŸ‰' : percentage >= 60 ? 'Ã‡ok iyi! ğŸ‘' : 'Tekrar deneyelim! ğŸ®')
                                        : (percentage >= 80 ? 'Harika bir performans!' : percentage >= 60 ? 'Ä°yi iÅŸ Ã§Ä±kardÄ±n!' : 'Daha fazla pratik yapmalÄ±sÄ±n!')
                                    }
                                </div>
                                
                                <div className="bg-gradient-to-r from-purple-100 to-blue-100 rounded-2xl p-6 mb-8">
                                    <div className="text-xl font-semibold mb-2">KazandÄ±ÄŸÄ±n Ã–dÃ¼ller:</div>
                                    <div className="flex justify-center space-x-8 text-lg">
                                        <div>ğŸ† +50 XP (Ders)</div>
                                        <div>â­ +{score} XP (AlÄ±ÅŸtÄ±rma)</div>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <button
                                        onClick={() => setCurrentScreen('units')}
                                        className="w-full py-4 bg-purple-600 text-white rounded-xl font-bold text-xl hover:bg-purple-700 transition"
                                    >
                                        Derslere DÃ¶n
                                    </button>
                                    <button
                                        onClick={() => {
                                            generateQuestions();
                                            setCurrentQ(0);
                                            setScore(0);
                                            setShowResults(false);
                                        }}
                                        className="w-full py-4 bg-gray-200 text-gray-800 rounded-xl font-bold text-xl hover:bg-gray-300 transition"
                                    >
                                        Tekrar Dene
                                    </button>
                                </div>
                            </div>
                        </div>
                    );
                }

                const question = questions[currentQ];

                return (
                    <div className={`min-h-screen ${isChild ? 'bg-gradient-to-br from-blue-100 to-purple-100' : 'bg-gray-50'}`}>
                        <div className={`text-white p-6 ${isChild ? 'bg-gradient-to-r from-pink-400 to-purple-500' : 'gradient-bg'}`}>
                            <div className="container mx-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <div className="text-xl font-bold">
                                        {isChild ? 'ğŸ¯' : ''} Soru {currentQ + 1} / {questions.length}
                                    </div>
                                    <div className="text-xl font-bold">
                                        {isChild ? 'â­' : 'ğŸ’'} {score} puan
                                    </div>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-full h-3">
                                    <div
                                        className="bg-white h-full rounded-full progress-bar"
                                        style={{width: `${((currentQ + 1) / questions.length) * 100}%`}}
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="container mx-auto px-4 py-12">
                            <div className="max-w-3xl mx-auto">
                                <div className={`rounded-3xl shadow-2xl p-8 mb-8 ${isChild ? 'bg-gradient-to-br from-yellow-50 to-pink-50 border-4 border-purple-300' : 'bg-white'}`}>
                                    <div className="flex items-center justify-center gap-4 mb-8">
                                        <h2 className={`text-3xl font-bold text-center ${isChild ? 'text-purple-700' : 'text-gray-800'}`}>
                                            {question.question}
                                        </h2>
                                        {isChild && (
                                            <button
                                                onClick={() => speakQuestion(question.question)}
                                                className="bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white p-4 rounded-full transition transform hover:scale-110 shadow-lg"
                                                title="Soruyu tekrar dinle"
                                            >
                                                <span className="text-3xl">ğŸ”Š</span>
                                            </button>
                                        )}
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {question.options.map((option, index) => {
                                            let bgColor = isChild
                                                ? 'bg-gradient-to-r from-blue-200 to-purple-200 hover:from-blue-300 hover:to-purple-300'
                                                : 'bg-gray-100 hover:bg-gray-200';

                                            if (selectedAnswer !== null) {
                                                if (option === question.correct) {
                                                    bgColor = isChild
                                                        ? 'bg-gradient-to-r from-green-400 to-green-500 text-white border-4 border-yellow-400'
                                                        : 'bg-green-500 text-white';
                                                } else if (option === selectedAnswer) {
                                                    bgColor = isChild
                                                        ? 'bg-gradient-to-r from-red-400 to-red-500 text-white shake'
                                                        : 'bg-red-500 text-white shake';
                                                } else {
                                                    bgColor = 'bg-gray-200';
                                                }
                                            }

                                            return (
                                                <button
                                                    key={index}
                                                    onClick={() => handleAnswer(option)}
                                                    disabled={selectedAnswer !== null}
                                                    className={`p-6 rounded-xl font-semibold text-lg transition transform ${bgColor} ${
                                                        selectedAnswer === null ? 'cursor-pointer hover:scale-105' : 'cursor-default'
                                                    } ${isChild ? 'text-2xl shadow-lg' : ''}`}
                                                >
                                                    {isChild && 'ğŸ¯ '}{option}
                                                </button>
                                            );
                                        })}
                                    </div>

                                    {isCorrect !== null && (
                                        <div className={`mt-8 p-6 rounded-xl text-center text-xl font-bold ${
                                            isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                        }`}>
                                            {isCorrect ? 'âœ“ DoÄŸru! +10 XP' : 'âœ— YanlÄ±ÅŸ! DoÄŸru cevap: ' + question.correct}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Dinleme Testi EkranÄ±
            const ListeningTestScreen = () => {
                const [questions, setQuestions] = useState([]);
                const [currentQ, setCurrentQ] = useState(0);
                const [selectedAnswer, setSelectedAnswer] = useState(null);
                const [isCorrect, setIsCorrect] = useState(null);
                const [score, setScore] = useState(0);
                const [showResults, setShowResults] = useState(false);
                const [hasPlayed, setHasPlayed] = useState(false);

                useEffect(() => {
                    generateListeningQuestions();
                }, []);

                const generateListeningQuestions = () => {
                    const allWords = [];

                    // TÃ¼m kelime derslerinden kelimeleri topla
                    Object.keys(lessonsDatabase).forEach(level => {
                        lessonsDatabase[level].units.forEach(unit => {
                            unit.lessons.forEach(lesson => {
                                if (lesson.type === 'vocabulary' && lesson.words) {
                                    allWords.push(...lesson.words);
                                }
                            });
                        });
                    });

                    // Rastgele 10 kelime seÃ§
                    const selectedWords = shuffleArray(allWords).slice(0, 10);

                    const generatedQuestions = selectedWords.map(word => ({
                        word: word.en,
                        correctImage: word.image,
                        correctTranslation: word.tr,
                        options: generateImageOptions(word, allWords)
                    }));

                    setQuestions(generatedQuestions);
                };

                const generateImageOptions = (correctWord, allWords) => {
                    const options = [{ tr: correctWord.tr, image: correctWord.image, en: correctWord.en }];

                    const otherWords = allWords.filter(w => w.en !== correctWord.en);
                    const shuffled = shuffleArray(otherWords);

                    for (let i = 0; i < 3 && i < shuffled.length; i++) {
                        options.push({ tr: shuffled[i].tr, image: shuffled[i].image, en: shuffled[i].en });
                    }

                    return shuffleArray(options);
                };

                const shuffleArray = (array) => {
                    const newArray = [...array];
                    for (let i = newArray.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                    }
                    return newArray;
                };

                const playWord = () => {
                    speak(questions[currentQ].word);
                    setHasPlayed(true);
                };

                const handleAnswer = (answer) => {
                    if (selectedAnswer !== null) return;

                    setSelectedAnswer(answer);
                    const correct = answer.en === questions[currentQ].word;
                    setIsCorrect(correct);

                    if (correct) {
                        setScore(score + 10);
                        setUserProgress({
                            ...userProgress,
                            totalXP: userProgress.totalXP + 10
                        });
                    }

                    setTimeout(() => {
                        if (currentQ < questions.length - 1) {
                            setCurrentQ(currentQ + 1);
                            setSelectedAnswer(null);
                            setIsCorrect(null);
                            setHasPlayed(false);
                        } else {
                            setShowResults(true);
                        }
                    }, 2000);
                };

                if (questions.length === 0) {
                    return (
                        <div className="min-h-screen flex items-center justify-center">
                            <div className="text-2xl">Sorular hazÄ±rlanÄ±yor...</div>
                        </div>
                    );
                }

                if (showResults) {
                    const percentage = (score / (questions.length * 10)) * 100;

                    return (
                        <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                            <div className="bg-white rounded-3xl shadow-2xl p-12 max-w-2xl w-full text-center fade-in">
                                <div className="text-7xl mb-6">
                                    {percentage >= 80 ? 'ğŸ‰ğŸ§' : percentage >= 60 ? 'ğŸ‘‚ğŸ‘' : 'ğŸ’ªğŸ“š'}
                                </div>
                                <h2 className="text-4xl font-bold text-gray-800 mb-4">Dinleme Testi TamamlandÄ±!</h2>
                                <div className="text-6xl font-bold text-blue-600 mb-6">{score} / {questions.length * 10}</div>
                                <div className="text-2xl text-gray-600 mb-8">
                                    {percentage >= 80 ? 'Harika dinleme becerisi!' :
                                     percentage >= 60 ? 'Ä°yi bir performans!' :
                                     'Daha fazla dinleme pratiÄŸi yap!'}
                                </div>

                                <div className="bg-gradient-to-r from-blue-100 to-cyan-100 rounded-2xl p-6 mb-8">
                                    <div className="text-xl font-semibold mb-2">KazandÄ±ÄŸÄ±n XP:</div>
                                    <div className="text-3xl font-bold text-blue-600">+{score} XP</div>
                                </div>

                                <div className="space-y-4">
                                    <button
                                        onClick={() => setCurrentScreen('home')}
                                        className="w-full py-4 bg-purple-600 text-white rounded-xl font-bold text-xl hover:bg-purple-700 transition"
                                    >
                                        Ana Sayfaya DÃ¶n
                                    </button>
                                    <button
                                        onClick={() => {
                                            generateListeningQuestions();
                                            setCurrentQ(0);
                                            setScore(0);
                                            setShowResults(false);
                                            setHasPlayed(false);
                                        }}
                                        className="w-full py-4 bg-blue-500 text-white rounded-xl font-bold text-xl hover:bg-blue-600 transition"
                                    >
                                        Tekrar Dene
                                    </button>
                                </div>
                            </div>
                        </div>
                    );
                }

                const question = questions[currentQ];

                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="gradient-bg text-white p-6">
                            <button
                                onClick={() => setCurrentScreen('home')}
                                className="mb-4 px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition"
                            >
                                â† Geri
                            </button>
                            <div className="container mx-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <div className="text-xl font-bold">Soru {currentQ + 1} / {questions.length}</div>
                                    <div className="text-xl font-bold">ğŸ§ {score} puan</div>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-full h-3">
                                    <div
                                        className="bg-white h-full rounded-full progress-bar"
                                        style={{width: `${((currentQ + 1) / questions.length) * 100}%`}}
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="container mx-auto px-4 py-12">
                            <div className="max-w-4xl mx-auto">
                                <div className="bg-white rounded-3xl shadow-2xl p-8 mb-8">
                                    <h2 className="text-3xl font-bold text-gray-800 text-center mb-6">
                                        ğŸ‘‚ Dinleme Testi
                                    </h2>
                                    <p className="text-center text-gray-600 mb-8">
                                        Ses butonuna tÄ±klayÄ±n ve duyduÄŸunuz kelimeyi gÃ¶steren gÃ¶rseli seÃ§in
                                    </p>

                                    {/* Ses Ã‡alma Butonu */}
                                    <div className="text-center mb-8">
                                        <button
                                            onClick={playWord}
                                            className="bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-12 py-6 rounded-2xl font-bold text-2xl hover:scale-105 transition transform shadow-lg"
                                        >
                                            ğŸ”Š {hasPlayed ? 'Tekrar Dinle' : 'Kelimeyi Dinle'}
                                        </button>
                                    </div>

                                    {/* Cevap SeÃ§enekleri */}
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        {question.options.map((option, index) => {
                                            let borderColor = 'border-gray-300';
                                            let bgColor = 'bg-white hover:bg-gray-50';

                                            if (selectedAnswer !== null) {
                                                if (option.en === question.word) {
                                                    borderColor = 'border-green-500 border-4';
                                                    bgColor = 'bg-green-100';
                                                } else if (option.en === selectedAnswer.en) {
                                                    borderColor = 'border-red-500 border-4';
                                                    bgColor = 'bg-red-100 shake';
                                                }
                                            }

                                            return (
                                                <button
                                                    key={index}
                                                    onClick={() => handleAnswer(option)}
                                                    disabled={selectedAnswer !== null}
                                                    className={`p-6 rounded-xl border-2 ${borderColor} ${bgColor} transition cursor-pointer`}
                                                >
                                                    <div className="text-6xl mb-3">{option.image}</div>
                                                    <div className="font-semibold text-gray-800">{option.tr}</div>
                                                </button>
                                            );
                                        })}
                                    </div>

                                    {/* Geri Bildirim */}
                                    {isCorrect !== null && (
                                        <div className={`mt-8 p-6 rounded-xl text-center text-xl font-bold ${
                                            isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                        }`}>
                                            {isCorrect
                                                ? `âœ“ Harika! DoÄŸru cevap: "${question.word}" +10 XP`
                                                : `âœ— YanlÄ±ÅŸ! DoÄŸru cevap: "${question.word}" (${question.correctTranslation})`
                                            }
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Animasyonlu Karakter BileÅŸeni (Sadece Ã§ocuk modunda)
            const FloatingCharacter = () => {
                const [position, setPosition] = useState({ x: 20, y: 20 });

                useEffect(() => {
                    const moveCharacter = () => {
                        const maxX = window.innerWidth - 150;
                        const maxY = window.innerHeight - 200;

                        const newX = Math.random() * maxX;
                        const newY = Math.random() * maxY;

                        setPosition({ x: newX, y: newY });
                    };

                    // Her 8 saniyede bir karakteri hareket ettir
                    const interval = setInterval(moveCharacter, 8000);

                    return () => clearInterval(interval);
                }, []);

                if (!characterPhoto || userProfile !== 'child') return null;

                return (
                    <div
                        className="floating-character"
                        style={{
                            left: `${position.x}px`,
                            top: `${position.y}px`,
                        }}
                    >
                        <div className="character-body" style={{ position: 'relative', width: '140px', height: '200px' }}>
                            <CharacterBody character={selectedCharacter} size="normal" showAnimations={true} />

                            {/* YÃ¼z - SVG'nin Ã¼zerine */}
                            <div style={{
                                position: 'absolute',
                                top: '3px',
                                left: '50%',
                                transform: 'translateX(-50%)',
                                zIndex: 10
                            }}>
                                <img
                                    src={characterPhoto}
                                    alt="Karakter"
                                    className="character-face"
                                    style={{
                                        width: '70px',
                                        height: '70px',
                                        objectFit: 'cover',
                                        display: 'block'
                                    }}
                                />
                            </div>
                        </div>
                    </div>
                );
            };

            // Ekran yÃ¶nlendirmesi
            return (
                <>
                    {currentScreen === 'profile' && <ProfileSelectionScreen />}
                    {currentScreen === 'character-create' && <CharacterCreateScreen />}
                    {currentScreen === 'character-select' && <CharacterSelectScreen />}
                    {currentScreen === 'home' && <HomeScreen />}
                    {currentScreen === 'units' && <UnitsScreen />}
                    {currentScreen === 'lesson' && <LessonScreen />}
                    {currentScreen === 'exercise' && <ExerciseScreen />}
                    {currentScreen === 'listening' && <ListeningTestScreen />}

                    {/* Animasyonlu Karakter */}
                    <FloatingCharacter />
                </>
            );
        }

        // UygulamayÄ± baÅŸlat
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AlyaGoApp />);
    </script>
</body>
</html>
